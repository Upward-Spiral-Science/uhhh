# Supplemental Final Report
***David West***<br/>
May 12, 2016

-------------------

**Table of Contents:**
- [Overview](./SupplementalReport-DW.md.md#overview)
- [Description of Region Adjacency Graphs]()
  - [Region Adjacency Overview]()
  - [Initial Considerations and Attempts]()
  - [Non-Linear Edge Weighting]()
  - [Normalized, Linear Edge Weighting]()
- [Trends in Graph Connectivity Using Mean Edge Weights]()

## Overview
This supplemental final report explores the synaptic density data further. The [primary final report](https://github.com/Upward-Spiral-Science/uhhh/blob/master/FinalReport.md#final-report-uhhh) was prepared on May 5, 2016, and examines data taken from 2011 M. musculus V1 dataset from Network anatomy and in vivo physiology of visual cortical neurons (Bock et al). Amongst a few key insights, a primary finding of the initial analyses was that the y-axis of the 3D volume was aligned with the z-axis of the brain, or the axis along which cortical layers vary. The report found key inflection points in synaptic density down the volume's y-axis. The report also offered a cursory analysis of clustering and trends in synaptic distribution down the y-axis, as well as through the x and z axes.

The analyses in this report seeks to answer questions about the properites of the data, primarily considering how the arrangement of synapses differs along the y-axis of the image. Namely, we ask:

* _What other features besides simple synaptic density can be used to describe the tissue?_
* _Using these features, what trends arise as we traverse into deeper cortical layers?_
* _Do any features discriminate boundaries between layers?_
* _If so, do these features discriminate between the boundaries as well, or better than mean or max synaptic density, as described in the earlier report?_

In our [initial questions](https://github.com/Upward-Spiral-Science/uhhh/blob/master/draft/questions.md) we suggested that graphs might be constructed on the data. To open up our domain of possible features used to describe the tissue, we construct graphs and measure properties of those graphs.

## Description of Region Adjacency Graphs (RAG)

### Initial Considerations and Attempts
An initial thought was to construct Delaunay and/or its dual Voronoi graphs. However, these graphs consider only  spatial information. Because the supervoxels are evenly spaced, and because our "resolution" of information is only as high as these supervoxels, spatial-only graphs provide no additional insight. We must consider density information as well. A first attempt was to construct the Delaunay in such a way that used distance between synaptic weights as the criteria for putting an edge between supervoxel nodes. In other words, we would be constructing the graph in _density space_. However, this would be  accounting for density information alone, and likely no more insightful than the analysis of the first report. 

### Region Adjacency Overview
To construct a graph that consider both spacial and density information, we'll use a Region Adjacency Graph (RAG). RAGs are used largely in image processing, and it makes sense for our data to look more like an image. Since the data is evenly spaced, the _absolute_ locations of the voxels don't matter. We can use the index in the matrix to represent spacial location, with the value at each pixel being the synapse density at that voxel. We've done this before in `real volume`.

In RAGs, two nodes are considered as neighbor if they are close in proximity (separated by a small number of pixels/voxels) in the horizontal or vertical direction. RAGs sometimes consider diagnonally "adjacent" pixels, but for these analyses, we only consider the horizontal and vertical neighbors.

<img src="./docs/figures/plot_rag_1.png" width="400">

### Non-Linear Edge Weighting
When two nodes are established as neighbors, the edge between the nodes is weights. Since our data includes density values at each node (voxel, or pixel since we're looking at y-layers), we can weight by the inverse of density difference between two nodes. Inverse because strongly connected nodes should be close in weight. We have number of synapses S<sub>i</sub> at nodes $i$ and define weights $w$ between the nodes:

$$w_j = \dfrac{1}{|S_i - S_{i+1}|}$$

Multiple analyses were performed using RAGs generated by this edge weighting function. Note that this function decays nonlinearly with absolute density difference.

### Normalized, Linear Edge Weighting
Another way to weight the graphs would be to pick a funtion that decays linearly with density distance from 1 to 0. In the nonlinear weighting function there appeared to be some edge effect behavior that causes that rapid change in statistics in deeper y-layers. To do this, we would need to scale the edge weights such that ${|S_i - S_{i+1}|}_{max}$ for each layer is scaled to 1 and ${|S_i - S_{i+1}|}_{min}$ is scaled to 0. The function we use to accomplish this is:

$$w_j = 1- (\dfrac{1}{{|S_i - S_{i+1}|}_{max} - {|S_i - S_{i+1}|}_{min}})*|S_i - S_{i+1}|$$

Note the scaling term $\dfrac{1}{{|S_i - S_{i+1}|}_{max} - {|S_i - S_{i+1}|}_{min}}$. The max and min synaptic density differences are calculated for each layer (as opposed for the whole volume).
 
 ## Exploratory Analysis
We 
<img src="http://i.imgur.com/WT3VMVQ.png" width="300"><img src="http://imgur.com/7KlDVhR.gif" width="325">

<img src="http://i.imgur.com/9gED0HH.png" width="300"><img src="http://imgur.com/CZIwzdl.gif" width="325">

## Trends in Graph Connectivity Using Mean Edge Weights
The edge weights are a measure of connectivity. Thus, we want to see how connectivity changes through the y-layers, which we confidently believe represents deeper cortical layers. We'll start by taking the mean edge weight for each layer as a measure of connectivity for that layer.

_**Note: Connectivity here is not referring to connectivity in the neuroscience sense, but rather in the graph theory sense. Closely "connected" supervoxels are closer in density, but might both be low in absolute synaptic density, and thus less connected in the neuroscience sense. For the purposes of this analysis, I'll generally consider connectivity to be graph connectivity unless otherwise stated."**_

<img src="http://imgur.com/wQqrd0X.png" width="400">

While it is difficult to see any kind of pattern that might quantitatively separate cortical layers as we saw in the simple mean density plots through the y-axis, we do see a trend in increasing mean edge weights as we get deeper into the y-layers. Specifically, we can see below that connectivity increases about 33% between the first and last layer considered (layer 0 and 39). Remember that we found that the the tissue becomes less dense as we traverse down the y-axis [(see here)](https://github.com/Upward-Spiral-Science/uhhh/blob/master/FinalReport.md#generating-a-plot-of-synaptic-density-as-a-function-of-cortical-depth). So at the least, we see that as tissue becomes less dense, the connectivity of the RAG increases.

### Further Understanding the Mean Edge Weights and RAG in General
These results are intriguing. Why would connectivity (as we define it) increase with cortical depth as the tissue becomes less synaptically-dense? Let's look at this further.

#### Impact of Sparse Image Layers
Because edge weight is a function of difference in density for neighboring supervoxels, the increase in average edge weight might be due to the fact that the distribution of synapses throughout the tissue is becoming more sparse, and thus more irregular throughout the tissue. It's worth noting that we have already eliminated the possibility of edge effects. Namely, since deepest 12 y-layers are matrices of nearly all 0's with some noise, one would expect that the edge means would be very high. Indeed, we can see below that when we put those edges back in, there is a large spike in the last 12 layers when padding becomes relevant.

<img src="http://imgur.com/l5B11Nr.png" width="400">

#### Correlation with Density Variance
In interpreting this RAG, let's hypothesize that graph connectivity is negatively correlated with density variance. It's reasonable to expect that higher variance in density would translate into an increased probability of having two very different supervoxels next to each other, and thus lower graph connectivity. To check this, let's look at the trend in variance.

<img src="http://imgur.com/sBDrw4G.png" width="400">

Indeed, as variance increases, connectivity decreases - it's more likely that there is a higher difference in synaptic density in neighboring super pixels with higher variance. We can see this correlation quantitatively with Pearson's coefficient between the density variance and mean edge weight:





